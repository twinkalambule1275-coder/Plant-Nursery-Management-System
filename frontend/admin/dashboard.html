<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Plant Nursery Management</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">Admin Dashboard</div>
        <div class="nav-links">
            <a href="../index.html">Home</a>
            <a href="#" id="username"></a>
            <a href="#" id="logout">Logout</a>
        </div>
    </nav>

    <div class="admin-container">
        <div class="sidebar">
            <h3>Management</h3>
            <ul>
                <li><a href="#" class="active" onclick="showSection('plants')">Plants</a></li>
                <li><a href="#" onclick="showSection('orders')">Orders</a></li>
                <li><a href="#" onclick="showSection('users')">Users</a></li>
            </ul>
        </div>

        <div class="main-content">
            <!-- Tabs for Management Sections -->
            <div class="tabs">
                <button class="tab-button" onclick="showSection('plants')">Plants</button>
                <button class="tab-button" onclick="showSection('orders')">Orders</button>
                <button class="tab-button" onclick="showSection('users')">Users</button>
            </div>

            <div id="plants-section" class="content-section">
                <div class="section-header">
                    <h2>Plant Management</h2>
                    <button class="btn-primary" onclick="showAddPlantModal()">Create Plant</button>
                </div>
                <div class="plant-list">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="plantTableBody">
                            <!-- Plants will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Order Management Section -->
            <div id="orders-section" class="content-section" style="display: none;">
                <h2>Order Management</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>User</th>
                            <th>Total Price</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        <!-- Orders will be loaded here -->
                    </tbody>
                </table>
            </div>

            <div id="users-section" class="content-section" style="display: none;">
                <h2>User Management</h2>
                <div class="user-list">
                    <!-- Users will be loaded here -->
                </div>
            </div>

            <section id="user-summary">
              <h2>Registered Users</h2>
              <table id="userTable">
                <thead>
                  <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                  </tr>
                </thead>
                <tbody id="userTableBody">
                  <script>
                     async function loadUsers() {
                         try {
                            const response = await fetch(`${API_BASE_URL}/admin/users`, {
                               headers: {
                                 'Authorization': `Bearer ${localStorage.getItem('token')}`
                               }
                            });
                            if(response.ok) {
                               const users = await response.json();
                               const tbody = document.getElementById('userTableBody');
                               tbody.innerHTML = '';
                               if(users.length === 0) {
                                  const row = document.createElement('tr');
                                  const cell = document.createElement('td');
                                  cell.colSpan = 3;
                                  cell.textContent = 'No users found';
                                  row.appendChild(cell);
                                  tbody.appendChild(row);
                               } else {
                                  users.forEach(user => {
                                     const row = document.createElement('tr');
                                     row.innerHTML = `<td>${user.username}</td><td>${user.email}</td><td>${user.role}</td>`;
                                     tbody.appendChild(row);
                                  });
                               }
                            } else {
                               console.error('Failed to load users');
                            }
                         } catch(error) {
                            console.error('Error:', error);
                         }
                     }
                     loadUsers();
                  </script>
                </tbody>
              </table>
            </section>
        </div>
    </div>

    <!-- Add Plant Modal -->
    <div id="addPlantModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add New Plant</h2>
            <form id="addPlantForm">
                <div class="form-group">
                    <label for="plantName">Plant Name</label>
                    <input type="text" id="plantName" required>
                </div>
                <div class="form-group">
                    <label for="plantPrice">Price</label>
                    <input type="number" id="plantPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="plantStock">Stock</label>
                    <input type="number" id="plantStock" required>
                </div>
                <div class="form-group">
                    <label for="plantDescription">Description</label>
                    <textarea id="plantDescription" required></textarea>
                </div>
                <button type="submit" class="btn-submit">Add Plant</button>
            </form>
        </div>
    </div>

    <script type="module" src="../js/admin.js"></script>
    <script>
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = 'none';
            });
            document.getElementById(`${section}-section`).style.display = 'block';
        }

        async function loadOrders() {
            const response = await fetch(`${API_BASE_URL}/admin/orders`, {
                headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
            });
            const orders = await response.json();
            const tbody = document.getElementById('orderTableBody');
            tbody.innerHTML = '';
            if (orders.length === 0) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 5;
                cell.textContent = 'No orders found';
                row.appendChild(cell);
                tbody.appendChild(row);
            } else {
                orders.forEach(order => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${order.user}</td>
                        <td>${order.totalPrice}</td>
                        <td>${order.status}</td>
                        <td>
                            <button onclick="updateOrderStatus(${order.id})">Update Status</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        // Load orders on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadUsers();
            loadOrders();
        });
    </script>
</body>
</html>